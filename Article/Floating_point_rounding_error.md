# 浮點數的舍入錯誤問題

前陣子一位老友忽然對編程興致大發，並跟我一起學習起Golang，我與她講解到浮點數一節時提到了關於浮點數的舍入錯誤問題。我的慣性思維令我對這一概念一帶而過，但她卻突然刨根問底。我嘗試講解的時候才發現自己對這個知識點也並未真正掌握，於是便重新整理了一遍關於浮點數的基礎概念。

## 計算機是如何用二進制數表示浮點數的

### IEEE754標準的浮點數表示法

![alt](https://upload.wikimedia.org/wikipedia/commons/7/75/General_floating_point_frac.svg)

借用维基百科的图来解释，计算机用这三部分的二进制数值组合起来来表示一个浮点数。

- **Sign** 符號位(sign bit)，0為正，1為負。
- **Exponent** 指數偏移值(exponent bias)，等於指數的實際值加上某個固定的值，IEEE 754標準規定該固定值為2^(e-1)^-1，*以單精度浮點數為例，指數域占8bit，固定偏移值就是 2^(8-1)^-1=127*
- **Fraction** 分數值(fraction)，儲存「有效數」的小數部份

以单精度（32bit）浮点数为例，用人类思维方式将十进制数转换为IEEE754標準的计算机浮点数的过程如下（以一个简单的十进制数 *10.25* 来举例）：

- 将其转换为二进制表示，2^3^+2^1^+2^-2^ = 1010.01，其指数形式为：1.01001*2^3^
- 分别得出三个域的值
  - 是正数，`sign`为0
  - 指数真实值为3，加上固定偏移值，`exponent`为3+127=130 (10000010)
  - 小数部分 `fraction`为01001
- 将这三个域的值按高低位完整组合起来就是：*0100 0001 0010 0100 0000 0000 0000 0000*

